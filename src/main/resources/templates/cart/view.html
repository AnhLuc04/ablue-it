
<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <title>Gi·ªè h√†ng</title>-->
<!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>-->
<!--</head>-->
<!--<body class="container py-5">-->

<!--<h2 class="mb-4">üõí Gi·ªè h√†ng c·ªßa b·∫°n</h2>-->

<!--<form id="cart-form">-->
<!--  <table class="table table-bordered text-center align-middle">-->
<!--    <thead class="table-dark">-->
<!--    <tr>-->
<!--      <th><input type="checkbox" id="select-all" /></th>-->
<!--      <th>S·∫£n ph·∫©m</th>-->
<!--      <th>Gi√°</th>-->
<!--      <th>S·ªë l∆∞·ª£ng</th>-->
<!--      <th>Th√†nh ti·ªÅn</th>-->
<!--    </tr>-->
<!--    </thead>-->
<!--    <tbody>-->
<!--    <tr th:each="item : ${cart.items}">-->
<!--      <td>-->
<!--        <input type="checkbox" class="item-checkbox" th:attr="data-id=${item.id}" />-->
<!--      </td>-->
<!--      <td>-->
<!--        <strong th:text="${item.product.name}">T√™n s·∫£n ph·∫©m</strong><br/>-->
<!--        <small th:if="${item.product.salePrice lt item.product.regularPrice}" class="text-danger">-->
<!--          üî• Gi·∫£m c√≤n-->
<!--          <span th:text="${item.product.salePrice}">0</span>-->
<!--          (<del th:text="${item.product.regularPrice}">0</del>)-->
<!--        </small>-->
<!--      </td>-->
<!--      <td th:text="${item.product.salePrice}">0</td>-->
<!--      <td>-->
<!--        <div class="d-flex justify-content-center align-items-center gap-2">-->
<!--          <button type="button" class="btn btn-outline-secondary btn-sm update-qty"-->
<!--                  th:attr="data-id=${item.id},data-action='decrease'">-</button>-->
<!--          <span th:attr="id='qty-' + ${item.id}" th:text="${item.quantity}">1</span>-->
<!--          <button type="button" class="btn btn-outline-secondary btn-sm update-qty"-->
<!--                  th:attr="data-id=${item.id},data-action='increase'">+</button>-->
<!--        </div>-->
<!--      </td>-->
<!--      <td>-->
<!--<span th:id="'subtotal-' + ${item.id}"-->
<!--      th:text="${(item.product.salePrice != null ? item.product.salePrice : 0) * item.quantity}">0</span>-->

<!--      </td>-->

<!--    </tr>-->
<!--    </tbody>-->
<!--  </table>-->
<!--</form>-->

<!--<div class="text-end mt-3">-->
<!--  <h4>-->
<!--    T·ªïng ti·ªÅn: <span id="total-price">0</span>-->
<!--  </h4>-->
<!--</div>-->

<!--<script>-->
<!--function calculateTotal() {-->
<!--  let total = 0;-->
<!--  $(".item-checkbox").each(function () {-->
<!--    const itemId = $(this).data("id");-->
<!--    const subtotalText = $("#subtotal-" + itemId).text().replace(" ƒë", "").replace(",", "");-->
<!--    const subtotal = parseFloat(subtotalText);-->
<!--    if (!isNaN(subtotal)) {-->
<!--      total += subtotal;-->
<!--    }-->
<!--  });-->
<!--  $("#total-price").text(total.toLocaleString() + " ƒë");-->
<!--}-->

<!--  $(document).ready(function () {-->
<!--    // TƒÉng / Gi·∫£m s·ªë l∆∞·ª£ng-->
<!--    $(".update-qty").click(function () {-->
<!--      const itemId = $(this).data("id");-->
<!--      const action = $(this).data("action");-->

<!--      $.ajax({-->
<!--        url: "/cart/update-ajax",-->
<!--        method: "POST",-->
<!--        data: {-->
<!--          itemId: itemId,-->
<!--          action: action-->
<!--        },-->
<!--     success: function (response) {-->
<!--  if (response.quantity !== undefined) {-->
<!--    $("#qty-" + itemId).text(response.quantity);-->

<!--    // ƒê·∫£m b·∫£o subtotal l√† s·ªë r·ªìi m·ªõi hi·ªÉn th·ªã-->
<!--    if (response.subtotal !== undefined && !isNaN(response.subtotal)) {-->
<!--      $("#subtotal-" + itemId).text(Number(response.subtotal).toLocaleString() + " ƒë");-->
<!--    } else {-->
<!--      console.warn("Subtotal kh√¥ng h·ª£p l·ªá:", response.subtotal);-->
<!--    }-->

<!--    calculateTotal(); // c·∫≠p nh·∫≠t l·∫°i t·ªïng-->
<!--  }-->
<!--}-->

<!--      });-->
<!--    });-->

<!--    // T√≠nh t·ªïng khi ch·ªçn checkbox-->
<!--    $(".item-checkbox, #select-all").on("change", function () {-->
<!--      if ($(this).is("#select-all")) {-->
<!--        $(".item-checkbox").prop("checked", this.checked);-->
<!--      }-->
<!--      calculateTotal();-->
<!--    });-->

<!--    // T√≠nh l·∫°i t·ªïng khi v√†o trang-->
<!--    calculateTotal();-->
<!--  });-->
<!--</script>-->

<!--</body>-->
<!--</html>-->



























<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Gi·ªè h√†ng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="container py-5">

<h2 class="mb-4">üõí Gi·ªè h√†ng c·ªßa b·∫°n</h2>

<form id="cart-form">
  <table class="table table-bordered text-center align-middle">
    <thead class="table-dark">
    <tr>
      <th><input type="checkbox" id="select-all" /></th>
      <th>S·∫£n ph·∫©m</th>
      <th>Gi√°</th>
      <th>S·ªë l∆∞·ª£ng</th>
      <th>Th√†nh ti·ªÅn</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="item : ${cart.items}">
      <td>
        <input type="checkbox" class="item-checkbox" th:attr="data-id=${item.id}" />
      </td>
      <td>
        <strong th:text="${item.product.name}">T√™n s·∫£n ph·∫©m</strong><br/>
        <small th:if="${item.product.salePrice lt item.product.regularPrice}" class="text-danger">
          üî• Gi·∫£m c√≤n
          <span th:text="${item.product.salePrice}">0</span>
          (<del th:text="${item.product.regularPrice}">0</del>)
        </small>
      </td>
      <td th:text="${item.product.salePrice}">0</td>
      <td>
        <div class="d-flex justify-content-center align-items-center gap-2">
          <button type="button" class="btn btn-outline-secondary btn-sm update-qty"
                  th:attr="data-id=${item.id},data-action='decrease'">-</button>
          <span th:attr="id='qty-' + ${item.id}" th:text="${item.quantity}">1</span>
          <button type="button" class="btn btn-outline-secondary btn-sm update-qty"
                  th:attr="data-id=${item.id},data-action='increase'">+</button>
        </div>
      </td>
      <td>
  <span th:id="'subtotal-' + ${item.id}"
        th:attr="data-price=${item.product.salePrice}"
        th:text="${item.product.salePrice * item.quantity}">0</span> $
      </td>

    </tr>
    </tbody>
  </table>
</form>

<div class="text-end mt-3">
  <h4>
    T·ªïng ti·ªÅn: <span id="total-price">0 $</span>
  </h4>
</div>

<script>
function calculateTotal() {
  let total = 0;
  $(".item-checkbox:checked").each(function () {
    const itemId = $(this).data("id");
    const subtotalText = $("#subtotal-" + itemId).text().replace(/[^\d]/g, ""); // lo·∫°i b·ªè m·ªçi k√Ω t·ª± kh√¥ng ph·∫£i s·ªë
    const subtotal = parseFloat(subtotalText);
    if (!isNaN(subtotal)) {
      total += subtotal;
    }
  });
$("#total-price").text("$" + total.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 }));

}


  $(document).ready(function () {
    $(".update-qty").click(function () {
      const itemId = $(this).data("id");
      const action = $(this).data("action");

      const $qtyEl = $("#qty-" + itemId);
      let currentQty = parseInt($qtyEl.text());

      // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng frontend ngay
      if (action === "increase") {
        currentQty += 1;
      } else if (action === "decrease" && currentQty > 1) {
        currentQty -= 1;
      }

      $qtyEl.text(currentQty);

      // T√≠nh l·∫°i th√†nh ti·ªÅn
      const price = parseFloat($("#subtotal-" + itemId).data("price"));
      const newSubtotal = price * currentQty;
      $("#subtotal-" + itemId).text(newSubtotal.toLocaleString());

      // G·ª≠i c·∫≠p nh·∫≠t l√™n backend
      $.ajax({
        url: "/cart/update-ajax",
        method: "POST",
        data: {
          itemId: itemId,
          action: action
        }
      });

      // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
      calculateTotal();
    });

    $(".item-checkbox, #select-all").on("change", function () {
      if ($(this).is("#select-all")) {
        $(".item-checkbox").prop("checked", this.checked);
      }
      calculateTotal();
    });

    calculateTotal();
  });
</script>

</body>
</html>
